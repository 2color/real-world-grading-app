# Migration `20200730163012-init-db`

This migration has been generated by Daniel Norman at 7/30/2020, 4:30:12 PM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
CREATE TYPE "UserRole" AS ENUM ('STUDENT', 'TEACHER');

CREATE TABLE "public"."User" (
"id" SERIAL,
"email" text  NOT NULL ,
"firstName" text  NOT NULL ,
"lastName" text  NOT NULL ,
"social" jsonb   ,
PRIMARY KEY ("id"))

CREATE TABLE "public"."Course" (
"id" SERIAL,
"name" text  NOT NULL ,
"courseDetails" text   ,
PRIMARY KEY ("id"))

CREATE TABLE "public"."CourseEnrollment" (
"createdAt" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,
"role" "UserRole" NOT NULL ,
"userId" integer  NOT NULL ,
"courseId" integer  NOT NULL ,
PRIMARY KEY ("userId","courseId"))

CREATE TABLE "public"."Test" (
"id" SERIAL,
"updatedAt" timestamp(3)  NOT NULL ,
"name" text  NOT NULL ,
"date" timestamp(3)  NOT NULL ,
"courseId" integer  NOT NULL ,
PRIMARY KEY ("id"))

CREATE TABLE "public"."TestResult" (
"id" SERIAL,
"createdAt" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,
"result" integer  NOT NULL ,
"studentId" integer  NOT NULL ,
"graderId" integer  NOT NULL ,
"testId" integer  NOT NULL ,
PRIMARY KEY ("id"))

CREATE UNIQUE INDEX "User.email" ON "public"."User"("email")

ALTER TABLE "public"."CourseEnrollment" ADD FOREIGN KEY ("userId")REFERENCES "public"."User"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."CourseEnrollment" ADD FOREIGN KEY ("courseId")REFERENCES "public"."Course"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."Test" ADD FOREIGN KEY ("courseId")REFERENCES "public"."Course"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."TestResult" ADD FOREIGN KEY ("studentId")REFERENCES "public"."User"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."TestResult" ADD FOREIGN KEY ("graderId")REFERENCES "public"."User"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."TestResult" ADD FOREIGN KEY ("testId")REFERENCES "public"."Test"("id") ON DELETE CASCADE ON UPDATE CASCADE
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration ..20200730163012-init-db
--- datamodel.dml
+++ datamodel.dml
@@ -1,0 +1,76 @@
+generator client {
+  provider        = "prisma-client-js"
+  previewFeatures = ["aggregateApi"]
+}
+
+datasource db {
+  provider = "postgresql"
+  url = "***"
+}
+
+model User {
+  id        Int    @default(autoincrement()) @id
+  email     String @unique
+  firstName String
+  lastName  String
+  social    Json?
+
+  // Relation fields
+  courses     CourseEnrollment[]
+  testResults TestResult[]       @relation(name: "results")
+  testsGraded TestResult[]       @relation(name: "graded")
+}
+
+model Course {
+  id            Int     @default(autoincrement()) @id
+  name          String
+  courseDetails String?
+
+  // Relation fields
+  members CourseEnrollment[]
+  tests   Test[]
+}
+
+model CourseEnrollment {
+  createdAt DateTime @default(now())
+  role      UserRole
+
+  // Relation Fields
+  userId   Int
+  courseId Int
+  user     User   @relation(fields: [userId], references: [id])
+  course   Course @relation(fields: [courseId], references: [id])
+
+  @@id([userId, courseId])
+}
+
+model Test {
+  id        Int      @default(autoincrement()) @id
+  updatedAt DateTime @updatedAt
+  name      String
+  date      DateTime
+
+  // Relation Fields
+  courseId   Int
+  course     Course       @relation(fields: [courseId], references: [id])
+  testResults TestResult[]
+}
+
+model TestResult {
+  id        Int      @default(autoincrement()) @id
+  createdAt DateTime @default(now())
+  result    Int // Percentage precise to one decimal point represented as `result * 10^-1`
+
+  // Relation Fields
+  studentId Int
+  student   User @relation(name: "results", fields: [studentId], references: [id])
+  graderId  Int
+  gradedBy  User @relation(name: "graded", fields: [graderId], references: [id])
+  testId    Int
+  test      Test @relation(fields: [testId], references: [id])
+}
+
+enum UserRole {
+  STUDENT
+  TEACHER
+}
```


